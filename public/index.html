<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SVRX Suggestions Web</title>
  <meta name="description" content="SVRX Suggestions Web — anonymous feedback form" />
  <style>
    :root{
      --bg-1:#031026; --bg-2:#06283f;
      --card:#071426; --ink:#e8f5ff; --muted:#9fb6da;
      --accent:#2b6ef6; --accent-2:#68a5ff;
      --glass:rgba(255,255,255,0.03);
      --radius:12px; --shadow:0 18px 48px rgba(2,6,23,0.6);
      --max-width:980px; --gap:14px; --touch:48px; --text:15px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    [data-theme="light"]{
      --bg-1:#f5f8ff; --bg-2:#eaf4ff; --card:#ffffff; --ink:#041726; --muted:#556b7f; --glass:rgba(2,6,23,0.04); --shadow:0 12px 30px rgba(3,10,24,0.06);
    }

    *{box-sizing:border-box}
    html{font-size:16px}
    body{
      margin:0; min-height:100vh; background:linear-gradient(140deg,var(--bg-1),var(--bg-2));
      color:var(--ink); display:flex; align-items:flex-start; justify-content:center; padding:22px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* container */
    .wrap{width:100%;max-width:var(--max-width);display:flex;flex-direction:column;gap:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:56px;height:56px;border-radius:10px;overflow:hidden;background:#01121b;flex-shrink:0;display:grid;place-items:center;
      box-shadow:0 10px 30px rgba(43,110,246,0.12)
    }
    .logo img{width:44px;height:44px;object-fit:contain;display:block;pointer-events:none;user-select:none}
    .titles{display:flex;flex-direction:column}
    .title-main{font-weight:800;font-size:1.05rem;margin:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .title-sub{font-size:0.95rem;color:var(--muted);margin-top:2px;line-height:1.05}

    .top-controls{display:flex;align-items:center;gap:8px}
    .btn-ghost{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer;font-weight:600}
    .btn-inline{padding:8px 10px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#012033;font-weight:700;cursor:pointer}

    /* card */
    main.card{background:var(--card);border-radius:var(--radius);padding:16px;border:1px solid rgba(255,255,255,0.04);box-shadow:var(--shadow);backdrop-filter:blur(6px)}
    .card-head{display:flex;align-items:center;gap:12px;margin-bottom:10px}
    .h-title{display:flex;flex-direction:column}
    .h-title h2{margin:0;font-size:1.05rem}
    .h-title p{margin:6px 0 0;color:var(--muted);font-size:0.95rem}

    /* grid */
    .grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} .logo img{width:40px;height:40px} .logo{width:48px;height:48px} }

    label{display:block;font-size:13px;color:var(--muted);margin-bottom:7px}
    input, select, textarea{
      width:100%; padding:11px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.035);
      background:var(--glass); color:var(--ink); font-size:var(--text);
    }
    textarea{min-height:140px;resize:vertical;line-height:1.45}
    .small{font-size:13px;color:var(--muted)}

    .left-panel{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .right-panel{display:flex;flex-direction:column;gap:12px}

    .meta-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .tips{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .tip{display:flex;gap:8px;align-items:flex-start}
    .dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(180deg,var(--accent),var(--accent-2));margin-top:6px}

    .actions{display:flex;gap:10px;align-items:center;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#012033;box-shadow:0 10px 30px rgba(43,110,246,0.12)}
    .btn-disabled{opacity:0.6;cursor:not-allowed}

    /* discord card smaller */
    .discord{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
    .discord img{width:40px;height:40px;border-radius:8px;object-fit:cover}

    /* inline validation */
    .field-error{color:#ff9a9a;font-size:13px;margin-top:8px;display:none}
    .field-error.visible{display:block}

    /* FAB */
    .fab{display:none;position:fixed;right:16px;bottom:16px;width:52px;height:52px;border-radius:999px;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--accent),var(--accent-2));box-shadow:0 12px 30px rgba(43,110,246,0.18);z-index:60;color:#012033;font-weight:800;cursor:pointer}
    @media (max-width:720px){ .fab{display:flex} }

    footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}

    @media (max-width:520px){
      body{padding:12px}
      .wrap{gap:12px}
      .card{padding:14px}
      .left-panel, .right-panel{padding:10px}
      .page-sub{font-size:0.9rem}
      .title-main{font-size:1rem}
      .grid{gap:12px}
      .btn{padding:10px 12px}
    }

    /* accessibility */
    :focus{outline:none}
    input:focus, textarea:focus, select:focus { outline:3px solid rgba(43,110,246,0.06); }
  </style>
</head>
<body data-theme="dark">
  <div class="wrap" role="application">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- Keep your logo in public/logo.png -->
          <img id="mainLogo" src="logo.png" alt="SVRX logo">
        </div>
        <div class="titles">
          <div class="title-main">SVRX Suggestions Web</div>
          <div class="title-sub">Your ideas help shape SVRX — simple & private.</div>
        </div>
      </div>

      <div class="top-controls" role="toolbar" aria-label="Top controls">
        <div class="discord" title="SVRX Community">
          <img src="logo.png" alt="SVRX">
          <div style="min-width:120px">
            <div style="font-weight:700;font-size:13px">SVRX Community</div>
            <div class="small">Chat with staff & other users</div>
          </div>
          <button id="joinDiscordTop" class="btn-ghost" aria-label="Join Discord">Join</button>
        </div>

        <button id="themeToggle" class="btn-ghost" aria-pressed="false" title="Toggle theme">Theme</button>
      </div>
    </header>

    <main class="card" id="card" role="main" aria-labelledby="heading">
      <div class="card-head">
        <div class="logo" aria-hidden="true" style="width:44px;height:44px"><img src="logo.png" alt=""></div>
        <div class="h-title">
          <h2 id="heading">Anonymous Feedback Box</h2>
          <p class="small">Send feedback, report issues, or share suggestions — we read every message.</p>
        </div>
      </div>

      <!-- form has no action or method to avoid native POST -->
      <form id="feedbackForm" onsubmit="return false">
        <div class="grid">
          <section class="left-panel">
            <div style="font-weight:600;color:var(--accent-2);margin-bottom:10px">Be clear and brief — examples help us act faster.</div>

            <label for="type">Feedback type</label>
            <select id="type" name="type" required>
              <option value="">Select type</option>
              <option>Suggestion</option>
              <option>Issue</option>
              <option>Other</option>
            </select>
            <div id="typeError" class="field-error">Please choose a feedback type.</div>

            <label for="message" style="margin-top:12px">Message</label>
            <textarea id="message" name="message" maxlength="1200" placeholder="Describe your feedback or idea clearly and briefly." required></textarea>
            <div id="messageError" class="field-error">Please write your message (min 3 characters).</div>

            <div class="meta-row">
              <div class="small">We read every message.</div>
              <div id="count" class="small" aria-live="polite">0 / 1200</div>
            </div>

            <div class="tips">
              <div class="tip"><div class="dot"></div><div>Add steps, device & browser when reporting issues.</div></div>
              <div class="tip"><div class="dot"></div><div>Prefer anonymity? Use an alias and disposable email in the fields on the right.</div></div>
            </div>
          </section>

          <aside class="right-panel">
            <section style="padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)">

              <label for="visitorName">Name</label>
              <input id="visitorName" name="visitorName" placeholder="Your name or alias" required>
              <div id="nameError" class="field-error">Please enter your name or alias.</div>

              <label for="visitorEmail" style="margin-top:10px">Email</label>
              <input id="visitorEmail" name="visitorEmail" type="email" placeholder="name@example.com" required>
              <div id="emailError" class="field-error">Please enter a valid email address.</div>

              <label for="impact" style="margin-top:10px">Priority (optional)</label>
              <select id="impact" name="impact">
                <option value="">No preference</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>

              <label for="extra" style="margin-top:10px">Additional details (optional)</label>
              <input id="extra" name="extra" placeholder="Screenshots, device, browser, or notes">

              <div class="actions">
                <button id="sendBtn" type="button" class="btn btn-primary">Send Feedback</button>
                <button id="resetBtn" type="button" class="btn btn-ghost">Clear</button>
              </div>

              <div id="status" class="small" role="status" aria-live="polite" style="margin-top:10px"></div>
            </section>

            <section class="discord" aria-hidden="false">
              <img src="logo.png" alt="">
              <div style="flex:1">
                <div style="font-weight:700">SVRX Community</div>
                <div class="small">Join to chat with staff, get updates, and report in real-time.</div>
              </div>
              <div style="display:flex;gap:8px">
                <button id="joinDiscord" class="btn-inline">Join Discord</button>
                <button id="copyInvite" class="btn-ghost">Copy Invite</button>
              </div>
            </section>
          </aside>
        </div>
      </form>
    </main>

    <footer>
      <div class="small">[STAFF] Made By Fluxieee</div>
    </footer>
  </div>

  <button class="fab" id="fab" title="Quick send">⇧</button>

  <script>
  (function(){
    // CONFIG
    const DISCORD_INVITE = 'https://discord.gg/ZEzx9dgk66'; // <-- set this to your actual invite
    const API_ENDPOINT = '/api/feedback';
    const DRAFT_KEY = 'svrx_draft_v6';

    // Elements
    const messageEl = document.getElementById('message');
    const countEl = document.getElementById('count');
    const sendBtn = document.getElementById('sendBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusEl = document.getElementById('status');
    const nameEl = document.getElementById('visitorName');
    const emailEl = document.getElementById('visitorEmail');
    const typeEl = document.getElementById('type');
    const impactEl = document.getElementById('impact');
    const extraEl = document.getElementById('extra');
    const joinDiscordTop = document.getElementById('joinDiscordTop');
    const joinDiscord = document.getElementById('joinDiscord');
    const copyInvite = document.getElementById('copyInvite');
    const themeToggle = document.getElementById('themeToggle');
    const fab = document.getElementById('fab');

    // inline errors
    const nameErr = document.getElementById('nameError');
    const emailErr = document.getElementById('emailError');
    const typeErr = document.getElementById('typeError');
    const messageErr = document.getElementById('messageError');

    // helpers
    function showStatus(kind, text){
      statusEl.className = 'small ' + (kind||'');
      statusEl.textContent = text || '';
      statusEl.style.display = text ? 'block' : 'none';
    }

    function setFieldError(el, visible, text){
      if(!el) return;
      if(visible){ el.classList.add('visible'); if(text) el.textContent = text; }
      else el.classList.remove('visible');
    }

    function updateCounter(){
      const n = messageEl?.value?.length || 0;
      countEl.textContent = n + ' / 1200';
    }

    // autosave
    function saveDraft(){
      try{
        const d = {
          type: typeEl?.value || '',
          impact: impactEl?.value || '',
          extra: extraEl?.value || '',
          message: messageEl?.value || '',
          name: nameEl?.value || '',
          email: emailEl?.value || ''
        };
        localStorage.setItem(DRAFT_KEY, JSON.stringify(d));
      }catch(e){}
    }
    function restoreDraft(){
      try{
        const raw = localStorage.getItem(DRAFT_KEY);
        if(!raw) return;
        const d = JSON.parse(raw);
        if(d.type) typeEl.value = d.type;
        if(d.impact) impactEl.value = d.impact;
        if(d.extra) extraEl.value = d.extra;
        if(d.message) messageEl.value = d.message;
        if(d.name) nameEl.value = d.name;
        if(d.email) emailEl.value = d.email;
        updateCounter();
      }catch(e){}
    }

    // events
    if(messageEl){
      messageEl.addEventListener('input', ()=>{ updateCounter(); saveDraft(); setFieldError(messageErr,false); });
    }
    [nameEl,emailEl,extraEl,typeEl,impactEl].forEach(el=>{ if(el) el.addEventListener('input', saveDraft); });

    // Prevent native form POST
    window.addEventListener('submit', (e)=> e.preventDefault(), true);

    // validation
    function validateFields(){
      let ok = true;
      const name = nameEl.value && nameEl.value.trim();
      const email = emailEl.value && emailEl.value.trim();
      const type = typeEl.value;
      const message = messageEl.value && messageEl.value.trim();

      setFieldError(nameErr,false);
      setFieldError(emailErr,false);
      setFieldError(typeErr,false);
      setFieldError(messageErr,false);

      if(!name){ setFieldError(nameErr,true,'Please enter your name or an alias.'); nameEl.focus(); ok=false; }
      if(!email){ setFieldError(emailErr,true,'Please enter your email.'); if(ok) emailEl.focus(); ok=false; }
      else if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){ setFieldError(emailErr,true,'Email looks invalid.'); if(ok) emailEl.focus(); ok=false; }
      if(!type){ setFieldError(typeErr,true,'Please choose a feedback type.'); if(ok) typeEl.focus(); ok=false; }
      if(!message || message.length < 3){ setFieldError(messageErr,true,'Please write a message (min 3 characters).'); if(ok) messageEl.focus(); ok=false; }

      return ok;
    }

    // send
    async function send(){
      if(sendBtn.disabled) return;
      if(!validateFields()) return;

      const payload = {
        name: nameEl.value.trim(),
        email: emailEl.value.trim(),
        type: typeEl.value,
        message: messageEl.value,
        impact: impactEl.value || '',
        extra: extraEl.value || ''
      };

      sendBtn.disabled = true;
      sendBtn.textContent = 'Sending...';
      showStatus('','');

      try{
        const res = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload),
        });
        const data = await res.json().catch(()=>({}));
        if(res.ok && data.ok){
          showStatus('ok','Feedback sent — thank you!');
          // clear message and optional meta but keep name/email
          messageEl.value = '';
          typeEl.value = '';
          impactEl.value = '';
          extraEl.value = '';
          saveDraft();
          updateCounter();
          subtleSuccess();
        } else {
          const msg = (data && data.error) ? data.error : ('Server error ' + (res.status || ''));
          showStatus('err', 'Send failed — ' + msg);
        }
      }catch(err){
        console.error('Send error', err);
        showStatus('err','Network error — please try again.');
      }finally{
        sendBtn.disabled = false;
        sendBtn.textContent = 'Send Feedback';
      }
    }

    // subtle success
    function subtleSuccess(){
      const logo = document.querySelector('.card .logo img');
      if(logo && logo.animate){
        logo.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:420,easing:'ease-out'});
      }
    }

    // wire UI
    if(sendBtn) sendBtn.addEventListener('click', send);
    if(resetBtn) resetBtn.addEventListener('click', ()=>{
      typeEl.value = '';
      messageEl.value = '';
      impactEl.value = '';
      extraEl.value = '';
      updateCounter();
      saveDraft();
      setFieldError(nameErr,false);
      setFieldError(emailErr,false);
      setFieldError(typeErr,false);
      setFieldError(messageErr,false);
      showStatus('','');
    });

    // keyboard submit
    if(messageEl) messageEl.addEventListener('keydown', (e)=>{
      if((e.ctrlKey||e.metaKey) && e.key === 'Enter'){ e.preventDefault(); send(); }
    });

    // FAB quick-send (mobile)
    if(fab) fab.addEventListener('click', ()=>{ send(); window.scrollTo({top:0,behavior:'smooth'}); });

    // discord actions
    function openInvite(){ window.open(DISCORD_INVITE, '_blank', 'noopener'); }
    if(joinDiscordTop) joinDiscordTop.addEventListener('click', openInvite);
    if(joinDiscord) joinDiscord.addEventListener('click', openInvite);
    if(copyInvite) copyInvite.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(DISCORD_INVITE); copyInvite.textContent = 'Copied ✓'; setTimeout(()=>copyInvite.textContent = 'Copy Invite',2000); }
      catch(e){ alert('Copy failed — invite: ' + DISCORD_INVITE); }
    });

    // theme toggle (dark default)
    function applyTheme(t){
      if(t === 'light') document.documentElement.setAttribute('data-theme','light');
      else document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('svrx_theme', t);
      // optional logo swap if you have two files: logo-light.png / logo-dark.png
      // const logo = document.getElementById('mainLogo'); if(logo) logo.src = (t==='light') ? 'logo-light.png' : 'logo.png';
    }
    (function initTheme(){
      const saved = localStorage.getItem('svrx_theme') || 'dark';
      applyTheme(saved);
    })();
    if(themeToggle) themeToggle.addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
      applyTheme(cur === 'light' ? 'dark' : 'light');
    });

    // particles (kept — no battery-saving logic)
    (function particles(){
      const canvas = document.createElement('canvas');
      canvas.id = 'particles';
      canvas.style.position = 'fixed';
      canvas.style.inset = '0';
      canvas.style.zIndex = '-3';
      canvas.style.opacity = '0.06';
      canvas.style.pointerEvents = 'none';
      document.body.appendChild(canvas);
      const ctx = canvas.getContext && canvas.getContext('2d');
      if(!ctx) return;
      function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
      resize(); window.addEventListener('resize', resize);
      const parts = Array.from({length:36}).map(()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:0.6+Math.random()*2.2,vx:(Math.random()-0.5)*0.2,vy:(Math.random()-0.5)*0.2,a:0.12+Math.random()*0.6}));
      function loop(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(const p of parts){
          p.x += p.vx; p.y += p.vy;
          if(p.x<0) p.x = canvas.width; if(p.x>canvas.width) p.x = 0;
          if(p.y<0) p.y = canvas.height; if(p.y>canvas.height) p.y = 0;
          ctx.beginPath(); ctx.fillStyle = `rgba(200,230,255,${p.a})`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
        }
        requestAnimationFrame(loop);
      }
      loop();
    })();

    // init counter + restore draft
    updateCounter();
    (function(){ try{ const raw = localStorage.getItem(DRAFT_KEY); if(!raw) return; const d = JSON.parse(raw); if(d.type) typeEl.value=d.type; if(d.impact) impactEl.value=d.impact; if(d.extra) extraEl.value=d.extra; if(d.message) messageEl.value=d.message; if(d.name) nameEl.value=d.name; if(d.email) emailEl.value=d.email; updateCounter(); }catch(e){} })();

    // expose helpers
    window.svrx = { send, saveDraft };

  })();
  </script>
</body>
</html>
